/* pkcs7.c
   Compile: gcc -std=c11 -O2 pkcs7.c -o pkcs7
*/

#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <string.h>

/*
 * Trả về buffer mới (malloc) chứa dữ liệu đã được padding.
 * - data: con trỏ tới dữ liệu gốc
 * - data_len: độ dài dữ liệu gốc
 * - block_size: kích thước block (1..255)
 * - out_len: nơi lưu độ dài buffer trả về
 * Trả về: con trỏ malloc hoặc NULL nếu lỗi.
 */
uint8_t *pkcs7_pad(const uint8_t *data, size_t data_len, uint8_t block_size, size_t *out_len) {
    if (!data || !out_len) return NULL;
    if (block_size == 0) return NULL;        // không hợp lệ
    if (block_size > 255) return NULL;       // PKCS#7 dùng 1 byte để biểu diễn giá trị padding

    uint8_t pad = (uint8_t)(block_size - (data_len % block_size));
    if (pad == 0) pad = block_size; // nếu vừa đúng block thì vẫn thêm 1 block padding

    *out_len = data_len + pad;
    uint8_t *out = malloc(*out_len);
    if (!out) return NULL;

    memcpy(out, data, data_len);
    // điền padding: mỗi byte = giá trị pad
    memset(out + data_len, pad, pad);

    return out;
}

/*
 * Tháo PKCS#7 padding inplace.
 * - buf: buffer chứa dữ liệu đã padding (được sửa inplace)
 * - buf_len: con trỏ tới độ dài hiện tại; khi thành công sẽ cập nhật độ dài sau khi unpad
 * - block_size: block size dùng khi padding
 * Trả về 0 nếu ok, -1 nếu lỗi (padding không hợp lệ)
 */
int pkcs7_unpad(uint8_t *buf, size_t *buf_len, uint8_t block_size) {
    if (!buf || !buf_len) return -1;
    if (block_size == 0 || block_size > 255) return -1;
    if (*buf_len == 0) return -1;

    uint8_t last = buf[*buf_len - 1];
    if (last == 0 || last > block_size) return -1; // giá trị padding không hợp lệ

    size_t pad = (size_t)last;
    if (pad > *buf_len) return -1; // padding lớn hơn dữ liệu -> sai

    // kiểm tra tất cả các byte padding có cùng giá trị
    for (size_t i = 0; i < pad; ++i) {
        if (buf[*buf_len - 1 - i] != last) return -1;
    }

    *buf_len = *buf_len - pad;
    return 0;
}

/* Ví dụ sử dụng */
int main(void) {
    /* bạn có thể chỉnh biến này để thay đổi 'block size' */
    uint8_t block_size = 16; // ví dụ AES = 16. Thay đổi tuỳ ý (1..255)

    const char *plain = "Hello, PKCS7!";
    size_t plain_len = strlen(plain);

    printf("Plain (%zu): \"%s\"\n", plain_len, plain);

    size_t padded_len;
    uint8_t *padded = pkcs7_pad((const uint8_t*)plain, plain_len, block_size, &padded_len);
    if (!padded) {
        fprintf(stderr, "Pad failed\n");
        return 1;
    }

    printf("Padded (len=%zu): ", padded_len);
    for (size_t i = 0; i < padded_len; ++i) {
        printf("%02x ", padded[i]);
    }
    printf("\n");

    /* thử unpad inplace */
    size_t buf_len = padded_len;
    int r = pkcs7_unpad(padded, &buf_len, block_size);
    if (r == 0) {
        printf("Unpad OK. New len=%zu. Data: \"", buf_len);
        // cẩn thận: dữ liệu không phải C-string nếu có byte 0 bên trong; dùng fwrite an toàn
        fwrite(padded, 1, buf_len, stdout);
        printf("\"\n");
    } else {
        printf("Unpad failed (invalid padding)\n");
    }

    free(padded);
    return 0;
}
